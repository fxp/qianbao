<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>7.领取并帮好友领红包</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="cache-control" content="no-cache">
    <meta content="telephone=no" name="format-detection"/>
    <link rel="stylesheet" type="text/css" href="css/hd.css">
    <script src="https://leancloud.cn/scripts/lib/av-0.4.7.min.js"></script>
</head>
<body>
<section class="wxhb_home">
    <section class="bd_begin">
        <section class="wl_fontone"></section>
        <section class="fonttwo_lqbhb"><span style=" font-size:4em; ">1000</span><span style=" font-size:1em; ">元</span>
        </section>
        <section class="anniu_help_begin">
            <section class="anniu_help_sy">
                <section class="wz">输入手机号 抢1000元红包</section>
                <section>赢羊年开门财运</section>
            </section>
        </section>
        <form action="">
            <section class="anniu_dh_begin">
                <input id="phoneNo" class="info" type="tel" placeholder="请输入手机号" title="手机号" name="mobile"
                       pattern="^1(([38]\d)|(4[57])|(5[012356789])|(7[0678]))\d{8}$" maxlength="11" required/>
            </section>
            <section class="anniu_begin">
                <section class="anniu_sy_begins" id="btn">领红包</section>
            </section>
        </form>
    </section>
    <section class="yiyou_btn_begin">红包成长二三事</section>
    <section class="yiyou_btn_begin_num">
        <section class="num1">1</section>
        <section class="num2"></section>
        <section class="num1_1">2</section>
        <section class="num2"></section>
        <section class="num1_1">3</section>
    </section>
    <section class="yiyou_btn_begin_num1">
        <section class="num3">领红包</section>
        <section class="num4">邀好友聚财</section>
        <section class="num5">金额增长</section>
    </section>
    <section class="help_jc">
        <ul>
            <li>
                <section class="no_money_show">
                    <section class="money_name">
                        <section class="begin_name_1">1.所得红包可直接用于零钱包账户进行投资理财。</section>
                        <section class="begin_name_2">2.红包在零钱包账户进行投资理财时此活动同步结束。</section>
                    </section>
                </section>
            </li>
        </ul>
    </section>
</section>
<a id="close" class="close" href="javascript:;" title="关闭当前窗口" style="text-decoration:none">
    <div id="alertdiv" style="display: none; width: 100%; height: 100%; overflow: hidden;background:transparent;">
        <div class="tanchukuang">
            <div class="wz_content">
                <div class="one_wz"><span><img src="images/jiantou.png" style=" visibility:hidden"/></span>选择<span><img
                                src="images/friendbz.png"/></span>分享给朋友<span><img src="images/jiantou.png"/></span>
                </div>
                <div class="two_wz">邀请好友帮你聚财</div>
                <div class="three_wz">让你的红包扩大10倍哦!</div>
            </div>
            <div class="fcbz"></div>
            <div class="wz_content">
                <div class="two_wz_bl">100元红包到手</div>
                <div class="three_wz_bl">让好友帮你聚财可增至1000元</div>
            </div>
            <div class="fcbz_fx"></div>
        </div>
    </div>
</a>
<script type="text/javascript">

    AV.initialize("pxu918ooco9l3s66xldjpyb42jlxgt5d8kp354ot75fkxr8i", "amvkbm9du0i35ulqccod2o0n6k6eawphw0akomf8hkf5hry4");


    function alertDiv(obj) {
        var w = document.createElement("div");
        w.setAttribute("id", "mybody"); //创建透明背景层(mybody)
        with (w.style) {
            position = 'absolute';
            zIndex = '10000';
            left = '0';
            top = '0';
            background = '#000000';
            filter = 'Alpha(opacity=80)';
            opacity = '0.8';
        }
        document.body.appendChild(w);
        w.onclick = closeDiv;
        if (!obj) return false;
        obj.style.display = "block";
        startMove(obj, '100%');
        with (obj.style) { // 设置 弹出框一些基本属性
            position = 'absolute';
            zIndex = '10001';
            left = "50%";
        }
    }
    ;
    var t = [];
    function startMove(obj, iTarget) { //运动
        if (obj.t) {
            clearInterval(obj.t);
            obj.t = null;
        }
        obj.t = setInterval(function () {
            doMove(obj, iTarget)
        }, 0);
    }
    ;
    var iSpeed = 0;
    function doMove(obj, iTarget) {
        iSpeed = (iTarget - obj.offsetHeight) / 5;
        iSpeed = iSpeed > 0 ? Math.ceil(iSpeed) : Math.floor(iSpeed); //速度取整
        if (obj.offsetHeight == iTarget) { // 目标点结束
            if (obj.t) {
                clearInterval(obj.t);
                obj.t = null;
                if (iTarget == 0) {
                    obj.style.display = "none";
                    document.body.removeChild(document.getElementById("mybody")); //删除节点
                }
            }
        } else {
            obj.style.height = obj.offsetHeight + iSpeed + "px";
        }

        onResize(obj); //调整弹出框位置
    }
    ;
    function onResize(obj) {
        if (!obj) return;
        var _bg = document.getElementById("mybody");
        var size = {width: 0, height: 0};
        size.width = Math.max(document.documentElement.scrollWidth, document.documentElement.clientWidth || document.body.clientWidth) + "px";
        size.height = Math.max(document.documentElement.scrollHeight, document.documentElement.clientHeight || document.body.clientHeight) + "px";
        //获取页面高度 和 宽度 最大值
        if (!_bg) return;
        _bg.style.width = size.width;
        _bg.style.height = size.height;

        with (obj.style) { //调整弹出框位置
            left = (parseInt(document.documentElement.clientWidth || document.body.clientWidth)) / 2 + (document.documentElement.scrollLeft || document.body.scrollLeft) - obj.offsetWidth / 2 + "px";
            top = (parseInt(document.documentElement.clientHeight || document.body.clientHeight)) / 2 + (document.documentElement.scrollTop || document.body.scrollTop) - obj.offsetHeight / 2 + "px";
        }
    }
    window.onresize = function () {
        //窗口发生改变，触发onResize函数 调整弹出框
        onResize(document.getElementById("alertdiv"));
    };


    document.getElementById("btn").onclick = function () { //显示弹出框
//        alertDiv(document.getElementById("alertdiv"));
        //
        var phoneNo = document.getElementById("phoneNo").value
        var isValid = true
        if (phoneNo.length === 11) {
            for (var i = 0; i < phoneNo.length; i++) {
                var num = phoneNo[i];
                if (num > '9' || num < '0') {
                    document.getElementById("btn").innerHTML = '请输入正确的手机号'
                    setTimeout(function () {
                        document.getElementById("btn").innerHTML = '领红包'
                    }, 2000)
                    isValid = false
                    break;
                }
            }
            if (isValid) {
                AV.Cloud.run('updatePhoneNo', {
                    hongbaoId: '',
                    phoneNo: phoneNo
                }).then(function (hongbao) {
                    window.history.replaceState('Object', 'Title', '/hongbao/hongbao');
                    alert('success')
                }, function (err) {
                    alert('failed')
                })
            }
        } else {
            isValid = false
            document.getElementById("btn").innerHTML = '请填写正确的手机号'
            setTimeout(function () {
                document.getElementById("btn").innerHTML = '领红包'
            }, 2000)
        }
    }
    document.getElementById("close").onclick = function () {
        closeDiv();
    }
    function closeDiv() { //关闭弹出框
        startMove(document.getElementById("alertdiv"), 0);
//        location.reload();
        // TODO jump to hongbao page
    }
</script>
</body>
</html>